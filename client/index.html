<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bomb</title>
</head>

<style>
    * {
        margin: 0;
        padding: 0;
        -webkit-tap-highlight-color: transparent;
    }

    body {
        overflow: hidden;
        cursor: pointer;
    }

    .line-draw {
        position: fixed;
        left: 0%;
        top: 0%;

        z-index: 12;
        display: flex;
        flex-wrap: wrap;

    }

    #canvas {
        background-color: black
    }

    .center {
        display: flex;
        background-color: white;
        position: fixed;
        z-index: 12;
        left: 50%;
        top: 50%;
        align-items: center;
        justify-content: center;
        transform: translate(-50%, -50%);
        flex-direction: column;
        width: fit-content;
        padding: 2.5rem;
        font-weight: border;
        border-radius: 12px;


    }

    .center * {
        width: 100%;
        margin: .3rem;
        font-weight: bolder;
    }

    .line-draw>button,
    .center button,
    .right>button {
        z-index: 12;
        padding: .3rem;
        cursor: pointer;
        color: white;
        background-color: blue;
        outline: none;
        border: none;
        border-radius: 2px;
        font-weight: border;
        font-size: 1.5rem;
        margin: .3rem;
        border-radius: 3px;

    }

    .line-draw>button:hover {
        background-color: red;
    }

    .red {
        text-align: center;
        color: red;
    }



    .none {
        display: none;
    }

    #p2 {
        text-align: center;
    }

    input {
        padding: .3rem 0;
    }

    .load {
        width: 20%;
    }

    .right {
        position: fixed;
        top: 0%;
        right: 0% !important;
    }
</style>

<body>

    <canvas id="canvas"></canvas>

    <div class="line-draw">
        <button>You :<span id="p">0</span></span></button>
    </div>
    <div class="right none">
        <button><span id="Ename">zeel</span> :<span id="pe">0</span></span></button>
    </div>

    <div class="center">
        <img class="load" src="./Load.svg">
        <p class="red"></p>

        <div class="tutorial none">
            <h1>Tutorial</h1>
            <p>Move the Hero (˂ and ˃ )</p>
            <p>Fire (Click on the enemy or ˄ )</p>
            <button onclick="Start()">Start</button>
        </div>

        <div class="main name_container">

            <h1>Enter Name</h1>
            <input id="name">
            <button onclick="AddUser()">Find</button>
        </div>

        <div class="main PlayBox none">
            <h1>
                <span id="EnemyName"></span>,
                Challengeds You
            </h1>


            <button onclick="Accepted()">Play With Him</button>
            <button onclick="NotAccepted()">Back</button>
        </div>



        <div class="main none enemy_container">
            <p id="you"></p>

            <h1>Enter Name To Find</h1>
            <input id="enemy">
            <button onclick="FindThePlayer()">Find</button>
        </div>

        <div class="score none">
            <h1 id="result" class="red"></h1>
            <h1>Your Score</h1>
            <h2 id="p2">0</h2>
            <button onclick="Home()">Home</button>
        </div>
        <div class="Wait none">
            <p>Let, see If Enemy Able to Bit You </p>
        </div>
    </div>
    <audio src="./1.mp3" id="Shoot"></audio>

</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.2/socket.io.min.js"></script>
<script>

    let name = "";
    let enemy = "";
    let tem = "";
    let RoomId = "";
    let EnemyEndPoint=-1;
    
    const Input_Name= document.getElementById("name")
    const Input_Name_p = document.getElementById("you")
    const Input_Enemy = document.getElementById("enemy")
    const Load = document.querySelector(".load")
    const Message = document.querySelector(".red")
    const EnemyName = document.querySelector("#Ename")
    const EnemyScore = document.querySelector("#pe")
    const Result = document.querySelector("#result")
    const EnemyBoxS = document.querySelector(".right")
    const WaitBox= document.querySelector(".Wait")
    const Tem_Input_Enemy = document.getElementById("EnemyName")
    const NameBox = document.querySelector('.name_container')
    const EnemyBox = document.querySelector('.enemy_container')
    const PlayBox = document.querySelector('.PlayBox')
    const Show_Score=document.querySelector('.score')
    const canvas  = document.querySelector('#canvas');
    const btn = document.querySelector('#p')
    const btn_ans = document.querySelector('#p2')
    const shoot= document.querySelector('#Shoot')
    const tutorial=document.querySelector('.center')
    
    
    
    
    var socket = io("http://localhost:3000");
    
    function FindThePlayer() {
    
        if(!Show_Score.classList.contains('none')){
    
            Show_Score.classList.add('none')
    
        }
    
        enemy = Input_Enemy.value;
        if (enemy == null) return;
        ToggleLoad()
        socket.emit(
            "UserFindAndJoin",
            enemy,
            name,
            (type) => {
    
                //console.log(type)
    
                ResponseEvent(type, () => {
    
                    PlayBox.classList.add('none')
                    EnemyBox.classList.remove('none');
    
                })
    
    
            })
    
    }
    
    function AddUser() {
        name = Input_Name.value;
        //console.log(name)
        if (name == null) return;
        ToggleLoad()
        socket.emit('AddUser', name,
            (type) => {
    
                ResponseEvent(type, () => {
    
                    Input_Name_p.innerHTML = "" + name;
                    NameBox.classList.add('none')
                    EnemyBox.classList.remove('none')
                })
    
    
    
            })
    
    }
    
    function ResponseEvent(type, callback) {
    
        ToggleLoad();
    
        if (!type) {
            callback()
        } else {
            display(type)
        }
    
    }
    
    function Accepted() {
        enemy = tem;
        socket.emit('ChallengeAccepted', name, enemy);
        PlayBox.classList.add('none');
    
    }
    
    function NotAccepted() {
    
        PlayBox.classList.add('none')
        EnemyBox.classList.remove('none');
        socket.emit('ChallengeAcceptedNotExcepted', name, tem);
        tem = ""
    
    }
    
    socket.on("UserRefuse", (to) => {
        //console.log(to, 123)
        if (to == name) {
    
            ResponseEvent("User Not youWant to play With ", () => {
    
    
            })
    
        }
    })
    
    function ToggleLoad() {
        Load.classList.toggle('none')
    }
    
    function display(data) {
        Message.innerHTML = "" + data;
        setTimeout(
    
            () => Message.innerHTML = ""
            ,
            3000
        )
    }
    
    function CallBack(type) {
    
        ToggleLoad(type);
    
    }
    
    function SendMyScore(value) {
        //console.log('callsend')
    
        socket.emit("ScoreChanged", RoomId, name, value)
    
    }
    
    function YourMathEnd(score) {
        //console.log('End')
    
        ToggleLoad()
        WaitBox.classList.remove('none')
        
        socket.emit("MathEnd", RoomId,score);
    }
    socket.on("UpdateScore", (to, value) => {
        //console.log('callfind')
    
        EnemyScore.innerHTML = "" + value
    
    
    });
    
    
    
    socket.on('connect', (socket) => {
        //console.log('connected')
    })
    
    socket.on("UserNotFound", (User) => {
        //console.log(User)
    });
    
    
    socket.on('All', (to, form) => {
    
    
        //console.log(to, name, to == name)
        if (to == name) {
            tem = form;
    
            Tem_Input_Enemy.innerHTML = "" + form;
            EnemyBox.classList.add('none')
            if(!Show_Score.classList.contains('none')){
    
                Show_Score.classList.add('none')
    
            }
            PlayBox.classList.remove('none')
    
    
        }
    });
    
    
    
    socket.on("EnterRoom", (roomId, to, form) => {
        RoomId = roomId;
        //console.log('room',to,form)
        EnemyBox.classList.add("none")
        if (to == name || form == name) {
    
            EnemyBoxS.classList.remove("none")
            EnemyName.innerHTML = "" + enemy;
            socket.emit('JoinRoom', RoomId,name)
            Start()
            if(!Load.classList.contains('none')){
                Load.classList.add('none')
    
            }
        }
    
    })
    
    function  ShowResult(score){
        if(EnemyEndPoint<=score){
            Result.innerHTML="You Win"
        }else{
            Result.innerHTML="You Loss"
        }
        if(!WaitBox.classList.contains('none')){
            WaitBox.classList.add('none')
        }
        Show_Score.classList.remove('none')
        if(!Load.classList.contains('none')){
            ToggleLoad();
        }
    
        socket.emit("MathEndBoth",RoomId,score,EnemyEndPoint);
        socket.emit("Left-Room",RoomId,name);
        score=0;
        EnemyEndPoint=-1;
        SendMyScore(score)
    }
    
    socket.on("YourEnd",(roomId,value,score)=>{
        EnemyEndPoint=value;
        ShowResult(score)
    })
    
    socket.on("EnemyMathEnd",(roomId,value)=>{
        EnemyEndPoint=value;
    })
    
    function Home(){
    
        Show_Score.classList.add('none');
        EnemyBox.classList.remove('none');
        EnemyEndPoint=-1;
        score=0;
        enemy = "";
        tem = "";
        RoomId = "";
        EnemyEndPoint=-1;
        EnemyBoxS.classList.add('none')
        btn.innerHTML="0"
    
        
    }
    
    
    ToggleLoad()
    
    


</script>
<script>var exports = {};</script>
<script type="text/javascript" src="/client/build/socket.js"></script>
<script type="text/javascript" src="/client/build/Variable.js"></script>
<script type="text/javascript" src="/client/build/index.js"></script>




</html>